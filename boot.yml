---
- hosts: all
  vars:
  - ubuntu_release: raring
  - logwatch_email: logwatch@goncalopereira.com
  - files_path: roles/boot/files
  - tasks_path: roles/boot/tasks
  - handlers_path: roles/boot/handlers
    
  tasks:  
  - include: $tasks_path/apt.yml tasks_path=$tasks_path

  - name: Install logwatch
    action: apt pkg=logwatch state=installed
 
  - name: Make logwatch mail $logwatch_email daily
    action: lineinfile dest=/etc/cron.daily/00logwatch regexp="^/usr/sbin/logwatch" line="/usr/sbin/logwatch --output mail --mailto $logwatch_email --detail high" state=present create=yes
 
  - name: Install ufw
    action: apt pkg=ufw state=installed

  - name: Install fail2ban
    action: apt pkg=fail2ban state=installed

  - name: Install psad
    action: apt pkg=psad state=installed

  - name: Start psad
    action: shell iptables -A INPUT -j LOG

  - include: $tasks_path/apt.yml tasks_path=$tasks_path
  - include: $tasks_path/ssh.yml
 
  - name: Enable ufw
    action: shell echo 'y' | ufw enable
 
  handlers:
  - include: $handlers_path/ssh.yml
